<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Distribution Optimization in Rural Areas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #00695c;
      --primary-dark: #004d40;
      --primary-light: #80cbc4;
      --accent: #ffab00;
      --accent-dark: #ff8f00;
      --white: #ffffff;
      --light-bg: #f5f5f5;
      --text: #333333;
      --text-light: #666666;
      --success: #2e7d32;
      --warning: #ff8f00;
      --error: #c62828;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      color: var(--text);
      line-height: 1.6;
      background-color: var(--light-bg);
      overflow-x: hidden;
    }

    .cover {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, rgba(0, 77, 64, 0.85) 0%, rgba(0, 105, 92, 0.85) 100%), 
                  url('https://images.unsplash.com/photo-1605000797499-95a51c5269ae?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80') center center/cover no-repeat;
      text-align: center;
      flex-direction: column;
      color: var(--white);
      position: relative;
      overflow: hidden;
      animation: fadeIn 1.5s ease-in-out;
      padding: 20px;
    }

    .cover-content {
      max-width: 800px;
      z-index: 2;
      animation: slideInUp 1s ease-out;
    }

    .cover h1 {
      font-size: 3.5rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      background: linear-gradient(to right, var(--white), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .cover p {
      font-size: 1.3rem;
      margin-bottom: 2.5rem;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
      opacity: 0.9;
    }

    .btn {
      display: inline-block;
      background-color: var(--accent);
      color: var(--text);
      padding: 15px 40px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 4px 20px rgba(255, 171, 0, 0.3);
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      background-color: var(--accent-dark);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(255, 171, 0, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }

    .btn:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }

    .container {
      display: none;
      max-width: 900px;
      margin: 40px auto;
      padding: 50px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease-in;
      background-color: var(--white);
      position: relative;
      overflow: hidden;
      transition: all 0.4s ease;
    }

    .container:hover {
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      transform: translateY(-5px);
    }

    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 8px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--accent));
      background-size: 200% 200%;
      animation: gradientBG 5s ease infinite;
    }

    .form-group {
      margin-bottom: 30px;
      position: relative;
    }

    label {
      font-weight: 500;
      display: block;
      margin-bottom: 12px;
      color: var(--primary-dark);
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }

    input, textarea, select {
      width: 100%;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 4px rgba(0, 150, 136, 0.15);
      background-color: var(--white);
      transform: translateY(-2px);
    }

    .btn-main {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white);
      padding: 16px 32px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 77, 64, 0.3);
      position: relative;
      overflow: hidden;
    }

    .btn-main:hover {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 77, 64, 0.4);
    }

    .btn-main:active {
      transform: translateY(1px);
    }

    .btn-main i {
      margin-right: 10px;
      transition: transform 0.3s ease;
    }

    .btn-main:hover i {
      transform: scale(1.2);
    }

    h2 {
      color: var(--primary-dark);
      margin-bottom: 30px;
      font-size: 2rem;
      position: relative;
      padding-bottom: 15px;
      display: flex;
      align-items: center;
    }

    h2::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 2px;
    }

    pre {
      background-color: #f5fbf8;
      padding: 25px;
      border-radius: 12px;
      font-size: 15px;
      white-space: pre-wrap;
      border-left: 5px solid var(--primary);
      font-family: 'Poppins', monospace;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      min-height: 200px;
    }

    pre:hover {
      box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .water-icon {
      color: var(--primary-light);
      margin-right: 15px;
      font-size: 1.3em;
      transition: all 0.3s ease;
    }

    .info-text {
      color: var(--text-light);
      font-size: 0.95rem;
      margin-top: 8px;
      font-style: italic;
    }

    .water-drop {
      position: absolute;
      width: 25px;
      height: 25px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2380cbc4"><path d="M12,2C9.33,2 4,10 4,14C4,17.31 7.58,20 12,20C16.42,20 20,17.31 20,14C20,10 14.67,2 12,2Z" /></svg>') no-repeat;
      opacity: 0.7;
      animation: float 6s infinite ease-in-out;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    .visualization {
      margin-top: 40px;
      padding: 20px;
      background-color: #f5fbf8;
      border-radius: 12px;
      border-left: 5px solid var(--primary);
      display: none;
    }

    .network-graph {
      width: 100%;
      height: 300px;
      background-color: white;
      border-radius: 8px;
      margin-top: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    .village-node {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      z-index: 2;
      transition: all 0.3s ease;
    }

    .village-node:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .pipeline {
      position: absolute;
      height: 4px;
      background-color: var(--primary-light);
      transform-origin: 0 0;
      z-index: 1;
    }

    .pipeline.mst {
      background-color: var(--accent);
      height: 6px;
    }

    .cost-label {
      position: absolute;
      background-color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
      color: var(--primary-dark);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 3;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }

    .stat-card {
      flex: 1;
      min-width: 200px;
      padding: 20px;
      background: linear-gradient(135deg, #f5fbf8 0%, #e0f2f1 100%);
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .stat-card h4 {
      color: var(--primary-dark);
      margin-bottom: 10px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
    }

    .stat-card h4 i {
      margin-right: 10px;
      color: var(--primary-light);
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-description {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .success-message {
      display: none;
      padding: 15px;
      background-color: rgba(46, 125, 50, 0.1);
      border-left: 5px solid var(--success);
      border-radius: 5px;
      margin-bottom: 20px;
      color: var(--success);
      font-weight: 500;
    }

    .warning-message {
      display: none;
      padding: 15px;
      background-color: rgba(255, 143, 0, 0.1);
      border-left: 5px solid var(--warning);
      border-radius: 5px;
      margin-bottom: 20px;
      color: var(--warning);
      font-weight: 500;
    }

    .error-message {
      display: none;
      padding: 15px;
      background-color: rgba(198, 40, 40, 0.1);
      border-left: 5px solid var(--error);
      border-radius: 5px;
      margin-bottom: 20px;
      color: var(--error);
      font-weight: 500;
    }

    /* New Table Styles */
    .connections-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .connections-table th {
      background-color: var(--primary);
      color: white;
      text-align: left;
      padding: 12px 15px;
    }

    .connections-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #dddddd;
    }

    .connections-table tr:nth-child(even) {
      background-color: #f3f3f3;
    }

    .connections-table tr:last-child td {
      border-bottom: none;
    }

    .connections-table input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: 'Poppins', sans-serif;
    }

    .connections-table input:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 2px rgba(0, 150, 136, 0.2);
    }

    .add-row-btn {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .add-row-btn:hover {
      background-color: var(--primary);
      color: white;
    }

    .remove-row-btn {
      background-color: #ffebee;
      color: var(--error);
      border: none;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .remove-row-btn:hover {
      background-color: var(--error);
      color: white;
    }

    .input-format-example {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid var(--accent);
    }

    .input-format-example h4 {
      margin-bottom: 10px;
      color: var(--primary-dark);
    }

    .input-format-example pre {
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
    }

    .tab-container {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: none;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
    }

    .tab:first-child {
      border-top-left-radius: 8px;
    }

    .tab:last-child {
      border-top-right-radius: 8px;
    }

    .tab.active {
      background-color: var(--primary);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-25px) rotate(5deg); }
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 1;
      }
      20% {
        transform: scale(25, 25);
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: scale(40, 40);
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @media (max-width: 768px) {
      .cover h1 {
        font-size: 2.5rem;
      }
      .cover p {
        font-size: 1.1rem;
      }
      .container {
        padding: 30px;
        margin: 20px;
      }
      h2 {
        font-size: 1.6rem;
      }
      .btn, .btn-main {
        width: 100%;
      }
      .stat-card {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="cover" id="coverPage">
    <div class="cover-content">
      <h1>Water Distribution Optimization</h1>
      <p>An intelligent solution for designing cost-effective water pipeline networks in rural communities</p>
      <button class="btn" onclick="enterProject()">
        <i class="fas fa-tint water-icon"></i> Start Optimization
      </button>
    </div>
    <!-- Water drop decorations -->
    <div class="water-drop" style="top:20%; left:10%; animation-delay:0s;"></div>
    <div class="water-drop" style="top:30%; right:15%; animation-delay:1s; width:20px; height:20px;"></div>
    <div class="water-drop" style="top:70%; left:15%; animation-delay:2s; width:30px; height:30px;"></div>
    <div class="water-drop" style="bottom:20%; right:10%; animation-delay:1.5s;"></div>
    <div class="water-drop" style="top:15%; right:20%; animation-delay:2.5s; width:18px; height:18px;"></div>
    <div class="water-drop" style="bottom:30%; left:20%; animation-delay:0.5s; width:22px; height:22px;"></div>
  </div>

  <div class="container" id="mainContainer">
    <h2><i class="fas fa-project-diagram water-icon"></i> Pipeline Network Design</h2>
    
    <div class="form-group">
      <label for="villages"><i class="fas fa-village water-icon"></i> Number of Villages</label>
      <input type="number" id="villages" placeholder="e.g., 4" min="1" max="20">
      <p class="info-text">Enter the total number of villages in the network (max 20 for visualization)</p>
    </div>

    <div class="tab-container">
      <button class="tab active" onclick="openTab(event, 'tableTab')">Table Input</button>
      <button class="tab" onclick="openTab(event, 'textTab')">Text Input</button>
    </div>

    <div id="tableTab" class="tab-content active">
      <div class="form-group">
        <label><i class="fas fa-table water-icon"></i> Pipeline Connections Table</label>
        <table class="connections-table" id="connectionsTable">
          <thead>
            <tr>
              <th>Village 1</th>
              <th>Village 2</th>
              <th>Cost (₹)</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="connectionsTableBody">
            <!-- Rows will be added here -->
          </tbody>
        </table>
        <button class="add-row-btn" onclick="addTableRow()">
          <i class="fas fa-plus"></i> Add Connection
        </button>
      </div>
    </div>

    <div id="textTab" class="tab-content">
      <div class="form-group">
        <label for="edges"><i class="fas fa-align-left water-icon"></i> Pipeline Connections (Text Format)</label>
        <textarea id="edges" rows="8" placeholder="Example format (one connection per line):
1 2 10
1 3 6
1 4 5
2 4 15
3 4 4"></textarea>
        <p class="info-text">Enter village connections and costs (Village1 Village2 Cost). Villages should be numbered from 1.</p>
      </div>
    </div>

    <div class="input-format-example">
      <h4><i class="fas fa-info-circle water-icon"></i> Input Format Example</h4>
      <p>For a network with 4 villages and these connections:</p>
      <pre>Village 1 ↔ Village 2 : Cost ₹10
Village 1 ↔ Village 3 : Cost ₹6
Village 1 ↔ Village 4 : Cost ₹5
Village 2 ↔ Village 4 : Cost ₹15
Village 3 ↔ Village 4 : Cost ₹4</pre>
      <p>Enter in table format or as text (one connection per line): <code>1 2 10</code>, <code>1 3 6</code>, etc.</p>
    </div>

    <button class="btn btn-main" onclick="computeMST()">
      <i class="fas fa-calculator"></i> Calculate Optimal Network
    </button>

    <div class="success-message" id="successMessage">
      <i class="fas fa-check-circle"></i> Success! Optimal pipeline network calculated.
    </div>

    <div class="warning-message" id="warningMessage">
      <i class="fas fa-exclamation-triangle"></i> Warning: Not all villages are connected. You may need to add more pipeline connections.
    </div>

    <div class="error-message" id="errorMessage">
      <i class="fas fa-times-circle"></i> Error: <span id="errorText"></span>
    </div>

    <div class="visualization" id="visualization">
      <h3><i class="fas fa-network-wired water-icon"></i> Network Visualization</h3>
      <div class="network-graph" id="networkGraph"></div>
    </div>

    <div class="stats-container" id="statsContainer">
      <div class="stat-card">
        <h4><i class="fas fa-money-bill-wave"></i> Total Cost</h4>
        <div class="stat-value" id="totalCost">₹0</div>
        <div class="stat-description">Total cost of the optimal pipeline network</div>
      </div>
      <div class="stat-card">
        <h4><i class="fas fa-pipe"></i> Pipelines</h4>
        <div class="stat-value" id="pipelineCount">0</div>
        <div class="stat-description">Number of pipelines in optimal network</div>
      </div>
      <div class="stat-card">
        <h4><i class="fas fa-average"></i> Average Cost</h4>
        <div class="stat-value" id="avgCost">₹0</div>
        <div class="stat-description">Average cost per pipeline</div>
      </div>
    </div>

    <h3 style="margin-top: 40px;"><i class="fas fa-poll water-icon"></i> Optimal Solution</h3>
    <pre id="output">Your optimized pipeline network will appear here...</pre>
  </div>

  <script>
    // Initialize with 3 empty rows
    document.addEventListener('DOMContentLoaded', function() {
      addTableRow();
      addTableRow();
      addTableRow();
    });

    function enterProject() {
      document.getElementById("coverPage").style.animation = "fadeOut 0.8s ease-out forwards";
      setTimeout(() => {
        document.getElementById("coverPage").style.display = "none";
        document.getElementById("mainContainer").style.display = "block";
        createWaterDrops();
      }, 800);
    }

    function createWaterDrops() {
      const container = document.getElementById('mainContainer');
      for (let i = 0; i < 12; i++) {
        const drop = document.createElement('div');
        drop.className = 'water-drop';
        drop.style.top = Math.random() * 80 + 10 + '%';
        drop.style.left = Math.random() * 80 + 10 + '%';
        drop.style.width = (Math.random() * 15 + 10) + 'px';
        drop.style.height = drop.style.width;
        drop.style.animationDelay = Math.random() * 4 + 's';
        drop.style.opacity = Math.random() * 0.5 + 0.3;
        container.appendChild(drop);
      }
    }

    function openTab(evt, tabName) {
      const tabContents = document.getElementsByClassName("tab-content");
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
      }

      const tabs = document.getElementsByClassName("tab");
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove("active");
      }

      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }

    function addTableRow() {
      const tableBody = document.getElementById('connectionsTableBody');
      const row = document.createElement('tr');
      
      const cell1 = document.createElement('td');
      const input1 = document.createElement('input');
      input1.type = 'number';
      input1.min = '1';
      input1.placeholder = '1';
      cell1.appendChild(input1);
      
      const cell2 = document.createElement('td');
      const input2 = document.createElement('input');
      input2.type = 'number';
      input2.min = '1';
      input2.placeholder = '2';
      cell2.appendChild(input2);
      
      const cell3 = document.createElement('td');
      const input3 = document.createElement('input');
      input3.type = 'number';
      input3.min = '1';
      input3.placeholder = '1000';
      cell3.appendChild(input3);
      
      const cell4 = document.createElement('td');
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-row-btn';
      removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
      removeBtn.onclick = function() {
        tableBody.removeChild(row);
      };
      cell4.appendChild(removeBtn);
      
      row.appendChild(cell1);
      row.appendChild(cell2);
      row.appendChild(cell3);
      row.appendChild(cell4);
      tableBody.appendChild(row);
    }

    function getEdgesFromTable() {
      const rows = document.getElementById('connectionsTableBody').rows;
      const edges = [];
      
      for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].cells;
        const village1 = cells[0].querySelector('input').value;
        const village2 = cells[1].querySelector('input').value;
        const cost = cells[2].querySelector('input').value;
        
        if (village1 && village2 && cost) {
          edges.push({
            u: parseInt(village1),
            v: parseInt(village2),
            cost: parseInt(cost)
          });
        }
      }
      
      return edges;
    }

    function getEdgesFromText() {
      const edgeInput = document.getElementById("edges").value.trim();
      const edgeLines = edgeInput.split('\n');
      const edges = [];
      
      for (let line of edgeLines) {
        if (line.trim() === "") continue;
        let parts = line.trim().split(/\s+/);
        if (parts.length === 3) {
          edges.push({
            u: parseInt(parts[0]),
            v: parseInt(parts[1]),
            cost: parseInt(parts[2])
          });
        }
      }
      
      return edges;
    }

    class DSU {
      constructor(n) {
        this.parent = Array.from({ length: n + 1 }, (_, i) => i);
      }
      find(x) {
        if (this.parent[x] !== x) {
          this.parent[x] = this.find(this.parent[x]);
        }
        return this.parent[x];
      }
      union(x, y) {
        const px = this.find(x);
        const py = this.find(y);
        if (px === py) return false;
        this.parent[py] = px;
        return true;
      }
    }

    function computeMST() {
      // Reset messages
      document.getElementById("successMessage").style.display = "none";
      document.getElementById("warningMessage").style.display = "none";
      document.getElementById("errorMessage").style.display = "none";
      
      const V = parseInt(document.getElementById("villages").value);
      let edges = [];
      
      // Check which tab is active
      const activeTab = document.querySelector('.tab-content.active').id;
      if (activeTab === 'tableTab') {
        edges = getEdgesFromTable();
      } else {
        edges = getEdgesFromText();
      }
      
      // Validate input
      if (isNaN(V) || V <= 0) {
        showError("Please enter a valid number of villages (must be a positive integer).");
        return;
      }

      try {
        for (let edge of edges) {
          if (isNaN(edge.u) || isNaN(edge.v) || isNaN(edge.cost) || edge.u <= 0 || edge.v <= 0 || edge.cost <= 0) {
            throw new Error(`Invalid values in connection: Village ${edge.u} ↔ Village ${edge.v} : ₹${edge.cost}. Village numbers and cost must be positive numbers.`);
          }
          if (edge.u > V || edge.v > V) {
            throw new Error(`Village number exceeds total villages in connection: Village ${edge.u} ↔ Village ${edge.v}. You entered ${V} villages.`);
          }
        }
      } catch (error) {
        showError(error.message);
        return;
      }

      if (edges.length === 0) {
        showError("Please enter at least one pipeline connection.");
        return;
      }

      edges.sort((a, b) => a.cost - b.cost);
      const dsu = new DSU(V);
      let mst = [];
      let totalCost = 0;

      for (let edge of edges) {
        if (dsu.union(edge.u, edge.v)) {
          mst.push(edge);
          totalCost += edge.cost;
        }
      }

      // Check if all villages are connected
      const root = dsu.find(1);
      let allConnected = true;
      for (let i = 2; i <= V; i++) {
        if (dsu.find(i) !== root) {
          allConnected = false;
          break;
        }
      }

      // Generate output
      let output = "=== Optimal Pipeline Layout ===\n\n";
      if (!allConnected) {
        output += "Warning: Not all villages are connected. You may need to add more pipeline connections.\n\n";
        document.getElementById("warningMessage").style.display = "block";
      } else {
        document.getElementById("successMessage").style.display = "block";
      }

      for (let e of mst) {
        output += `• Village ${e.u} ↔ Village ${e.v} : ₹${e.cost.toLocaleString()} \n`;
      }
      
      output += `\nTotal Minimum Cost: ₹${totalCost.toLocaleString()}\n`;
      output += `Number of Pipelines: ${mst.length}\n`;
      output += `Average Cost per Pipeline: ₹${(totalCost/mst.length).toFixed(2)}`;

      document.getElementById("output").textContent = output;
      
      // Update stats
      document.getElementById("totalCost").textContent = `₹${totalCost.toLocaleString()}`;
      document.getElementById("pipelineCount").textContent = mst.length;
      document.getElementById("avgCost").textContent = `₹${(totalCost/mst.length).toFixed(2)}`;
      
      // Show visualization if villages <= 20
      if (V <= 20) {
        visualizeNetwork(V, edges, mst);
        document.getElementById("visualization").style.display = "block";
      } else {
        document.getElementById("visualization").style.display = "none";
      }
      
      // Show stats container
      document.getElementById("statsContainer").style.display = "flex";
      
      // Pulse animation for results
      const resultElements = [
        document.getElementById("output"),
        document.getElementById("statsContainer"),
        document.getElementById("visualization")
      ];
      
      resultElements.forEach(el => {
        if (el.style.display !== "none") {
          el.style.animation = "pulse 0.5s ease";
          setTimeout(() => {
            el.style.animation = "";
          }, 500);
        }
      });
    }

    function showError(message) {
      document.getElementById("errorText").textContent = message;
      document.getElementById("errorMessage").style.display = "block";
      document.getElementById("output").textContent = "Please fix the input errors to calculate the optimal pipeline network.";
      document.getElementById("visualization").style.display = "none";
      document.getElementById("statsContainer").style.display = "none";
    }

    function visualizeNetwork(V, allEdges, mstEdges) {
      const graphContainer = document.getElementById("networkGraph");
      graphContainer.innerHTML = "";
      
      // Calculate positions for villages in a circular layout
      const centerX = graphContainer.offsetWidth / 2;
      const centerY = graphContainer.offsetHeight / 2;
      const radius = Math.min(centerX, centerY) * 0.8;
      
      // Create village nodes
      for (let i = 1; i <= V; i++) {
        const angle = (i * 2 * Math.PI / V) - Math.PI/2;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        
        const node = document.createElement("div");
        node.className = "village-node";
        node.textContent = i;
        node.style.left = `${x - 20}px`;
        node.style.top = `${y - 20}px`;
        graphContainer.appendChild(node);
      }
      
      // Draw all possible edges (light)
      allEdges.forEach(edge => {
        const angle1 = (edge.u * 2 * Math.PI / V) - Math.PI/2;
        const x1 = centerX + radius * Math.cos(angle1);
        const y1 = centerY + radius * Math.sin(angle1);
        
        const angle2 = (edge.v * 2 * Math.PI / V) - Math.PI/2;
        const x2 = centerX + radius * Math.cos(angle2);
        const y2 = centerY + radius * Math.sin(angle2);
        
        const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
        
        const line = document.createElement("div");
        line.className = "pipeline";
        line.style.width = `${length}px`;
        line.style.left = `${x1}px`;
        line.style.top = `${y1}px`;
        line.style.transform = `rotate(${angle}deg)`;
        graphContainer.appendChild(line);
        
        // Add cost label
        const label = document.createElement("div");
        label.className = "cost-label";
        label.textContent = edge.cost;
        label.style.left = `${(x1 + x2) / 2}px`;
        label.style.top = `${(y1 + y2) / 2}px`;
        graphContainer.appendChild(label);
      });
      
      // Draw MST edges (highlighted)
      mstEdges.forEach(edge => {
        const angle1 = (edge.u * 2 * Math.PI / V) - Math.PI/2;
        const x1 = centerX + radius * Math.cos(angle1);
        const y1 = centerY + radius * Math.sin(angle1);
        
        const angle2 = (edge.v * 2 * Math.PI / V) - Math.PI/2;
        const x2 = centerX + radius * Math.cos(angle2);
        const y2 = centerY + radius * Math.sin(angle2);
        
        const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
        
        const line = document.createElement("div");
        line.className = "pipeline mst";
        line.style.width = `${length}px`;
        line.style.left = `${x1}px`;
        line.style.top = `${y1}px`;
        line.style.transform = `rotate(${angle}deg)`;
        graphContainer.appendChild(line);
      });
    }
  </script>
</body>
</html>